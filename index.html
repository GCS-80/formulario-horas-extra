<script>
  // === RESTRICCIÓN DE FECHA: SOLO HOY Y AYER ===
  const fechaInput = document.querySelector('input[name="fecha"]');
  const hoy = new Date();
  const ayer = new Date(hoy);
  ayer.setDate(hoy.getDate() - 1);
  fechaInput.max = hoy.toISOString().split("T")[0];
  fechaInput.min = ayer.toISOString().split("T")[0];

  // === CÁLCULO AUTOMÁTICO DE HORAS ===
  const horaInicio = document.querySelector('input[name="hora_inicio"]');
  const horaFin = document.querySelector('input[name="hora_fin"]');
  const cantidadHoras = document.querySelector('input[name="cantidad"]');

  function calcularHoras() {
    if (horaInicio.value && horaFin.value) {
      const inicio = new Date(`1970-01-01T${horaInicio.value}`);
      const fin = new Date(`1970-01-01T${horaFin.value}`);
      if (fin > inicio) {
        const horas = (fin - inicio) / 1000 / 60 / 60;
        cantidadHoras.value = horas.toFixed(2);
      } else {
        cantidadHoras.value = "";
      }
    }
  }

  horaInicio.addEventListener("change", calcularHoras);
  horaFin.addEventListener("change", calcularHoras);

  // === RESTRICCIÓN PARA ORDEN / FACTURA: SOLO NÚMEROS Y ESPACIO ===
  const conceptoInput = document.getElementById("concepto");

  // Bloquear letras y caracteres no permitidos al teclear
  conceptoInput.addEventListener("keypress", function (e) {
    const char = e.key;

    // Teclas de control permitidas
    const controlKeys = ["Backspace", "Tab", "ArrowLeft", "ArrowRight", "Delete", "Home", "End"];
    if (controlKeys.includes(char)) return;

    // Solo números y espacio
    const regex = /^[0-9 ]$/;

    if (!regex.test(char)) {
      e.preventDefault();
      return;
    }
  });

  // Limpiar cualquier cosa rara pegada desde el portapapeles
  conceptoInput.addEventListener("input", function () {
    this.value = this.value.replace(/[^0-9 ]/g, "");
  });
</script>
